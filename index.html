<!DOCTYPE html>
<html lang="EN">
    <head>
        <title>GC21 Data Visualization With WebGL</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link href="./asset/css/style.css" type="text/css" rel="stylesheet"/>
        <link href="./favicon.ico" rel="icon" type="image/x-icon"/>
        <!-- fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@200&display=swap" rel="stylesheet">
    </head>
    <body>
        <canvas id="gl_canvas"></canvas>
        <div id="box"><div id="boxinner"></div></div>
        <script type="x-shader/x-vertex" id="earth.vert">#version 300 es
layout(location = 0) in vec3 vPosition;
layout(location = 1) in vec2 vinTexturecoord;
layout(location = 2) in vec2 vinCloudTexturecoord;
layout(location = 3) in vec3 vinTextureNormal;
uniform mat4 uProjectionMatrix;
uniform mat4 uViewMatrix;
uniform mat4 uWorldMatrix;
out vec2 voutTexturecoord;
out vec2 voutCloudTexturecoord;
out vec3 voutTextureNormal;

void main(void) {
    gl_Position = uProjectionMatrix * uViewMatrix * uWorldMatrix * vec4(vPosition, 1.0);
    voutTexturecoord = vinTexturecoord;
    voutCloudTexturecoord = vinCloudTexturecoord;
    voutTextureNormal = vinTextureNormal;
 }
        </script>
        <script type="x-shader/x-fragment" id="earth.frag">#version 300 es
#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
#else
    precision mediump float;
#endif
in vec2 voutTexturecoord;
in vec2 voutCloudTexturecoord;
in vec3 voutTextureNormal;
uniform sampler2D uDayTexture;
uniform sampler2D uNightTexture;
uniform sampler2D uCloudTexture;
uniform vec3 uLightDir;
//uniform vec3 uCameraLoc;

out vec4 Color;
void main(void) {
    const float dffborder = 0.25;
    vec3 day = texture(uDayTexture, voutTexturecoord).rgb;
    vec3 night = texture(uNightTexture, voutTexturecoord).rgb;
    vec4 cloud = texture(uCloudTexture, voutCloudTexturecoord).rgba;
    float shade = max(0.0, dot(voutTextureNormal, uLightDir) + dffborder);
    Color = vec4(day - shade, 1.0);

    if (shade >= dffborder) {
        if (night.r > night.b) {
            Color = vec4(night, 1.0);
        }
    }

    if (cloud.a >= 1.0) {
        Color = cloud;
    }
}
        </script>
        <script type="x-shader/x-vertex" id="flight.vert">#version 300 es
layout(location = 4) in vec3 vPosition;
uniform mat4 uProjectionMatrix;
uniform mat4 uViewMatrix;
uniform mat4 uWorldMatrix;
void main(void) {
    gl_Position = uProjectionMatrix * uViewMatrix * uWorldMatrix * vec4(vPosition, 1.0);
    gl_PointSize = 3.0;
}
        </script>
        <script type="x-shader/x-fragment" id="flight.frag">#version 300 es
#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
#else
    precision mediump float;
#endif
out vec4 Color;
void main(void) {
    Color = vec4(1.0, 0.0, 0.0, 1.0);
}
        </script>
        <script type="x-shader/x-vertex" id="pick.vert">#version 300 es
layout(location = 5) in vec3 vPosition;
layout(location = 6) in vec4 vinColor; //picker infomation
uniform mat4 uProjectionMatrix;
uniform mat4 uViewMatrix;
uniform mat4 uWorldMatrix;
out vec4 voutColor;
void main(void) {
    gl_Position = uProjectionMatrix * uViewMatrix * uWorldMatrix * vec4(vPosition, 1.0);
    gl_PointSize = 3.0;
    voutColor = vinColor;
}
        </script>
        <script type="x-shader/x-fragment" id="pick.frag">#version 300 es
#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
#else
    precision mediump float;
#endif
in vec4 voutColor; //picker information
out vec4 Color;

void main(void) {
    Color = voutColor;
}
        </script>
        <script type="x-shader/x-vertex" id="sky.vert"></script>
        <script type="x-shader/x-fragment" id="sky.frag"></script>
        <script src="./asset/js/main.js" type="module"></script>
    </body>
</html>